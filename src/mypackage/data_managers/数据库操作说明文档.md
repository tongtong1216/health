# 健康管理系统数据库操作接口文档

## 1. 用户管理 (UserManager)

`UserManager` 提供用户管理操作

### 1.1 创建用户 (create_user)

`UserManager.create_user(username: str, password_hash: str) -> int`  
**功能**：创建新用户并写入数据库  
**参数**：

| 参数名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| `username` | str | 唯一值 | 用户标识名，对应`usrname`字段 |
| `password_hash` | str | bcrypt加密值 | 安全存储的密码哈希 |

**返回值**：

| 返回值 | 条件 | 说明 |
|--------|------|------|
| `int=1` | 成功插入 | 受影响行数 |
| `None` | 违反唯一约束/数据库错误 | 需捕获异常处理 |

**SQL实现**：

```sql
INSERT INTO usr (usrname, password_hash) 
VALUES (%s, %s)
```

---

### 1.2 获取用户信息 (get_user)

`UserManager.get_user(username: str) -> Optional[Dict[str, Any]]`  
**功能**：完整查询用户信息  
**参数**：

| 参数名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| `username` | str | 非空 | 精确匹配用户名 |

**返回值字段说明**：

```python
{
    "user_id": int,         # 用户ID
    "usrname": str,         # 用户名
    "password_hash": str,   # 密码哈希
    "status": str,          # 账户状态(active/suspended)
    "last_login": datetime, # 最后登录时间
    "failed_attempts": int, # 连续失败次数
    "lock_expires": datetime# 锁定过期时间
}
```

---

### 1.3 更新登录状态 (update_login)

`UserManager.update_login(user_name: str, success: bool = True) -> int`  
**功能**：处理登录成功/失败的账户状态更新  

**参数**：

| 参数名 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| `user_name` | str | - | 目标用户名 |
| `success` | bool | True | True:登录成功 / False:登录失败 |

**返回值**：

| 代码 | 条件 | 说明 |
|------|------|------|
| 1 | 更新成功 | 用户名存在且完成更新 |
| 0 | 用户名不存在 | 无变更记录 |
| None | SQL执行错误 | 需异常处理 |

---

### 1.4 更新用户状态 (update_status)

`UserManager.update_status(user_name: str, status: str) -> int`  
**功能**：手动更新账户状态  

**参数约束**：

```python
status in ("active", "suspended")  # 仅允许两种状态值
```

**典型用例**：

```python
# 解除账户锁定
UserManager.update_status("user123", "active")

# 主动封禁账户
UserManager.update_status("spammer", "suspended")
```

---

## 2. 用户资料管理 (UserProfileManager)

### 2.1 创建用户资料

`create_profile(username: str, nickname: str = "新用户", gender: str = "prefer_not_to_say", birthdate: Optional[str] = None, height: Optional[float] = None, weight: Optional[float] = None, avatar_mime_type: str = "image/jpeg", avatar_base64: Optional[str] = None) -> int`  
**功能**：创建用户资料  
**参数说明**：  

| 参数名称 | 数据类型 | 约束说明 |
|----------|----------|----------|
| `username` | str | **必须参数**，需要关联的已存在系统用户名 |
| `nickname` | str | 用户昵称（默认值："新用户"），自动进行SQL转义 |
| `gender` | str | **枚举值约束**：仅接受'male'/'female'/'prefer_not_to_say'（默认值） |
| `birthdate` | Optional[str] | **格式约束**：YYYY-MM-DD（例如"2000-12-31"） |
| `height` | Optional[float] | 身高值（单位：厘米/cm），浮点类型 |
| `weight` | Optional[float] | 体重值（单位：千克/kg），浮点类型 |
| `avatar_mime_type` | str | 头像文件MIME类型（默认："image/jpeg"） |
| `avatar_base64` | Optional[str] | **完整BASE64编码字符串**（包含数据头） |

**返回值说明**：  

| 返回值 | 含义 | 触发场景 |
|--------|------|----------|
| 1 | 操作成功 | 记录成功创建 |
| 0 | 操作失败 | 用户名不存在/SQL执行错误 |

---

### 2.2 获取用户资料

`get_profile(username: str) -> Optional[Dict[str, Any]]`  

**功能**：通过用户名查询完整用户资料信息
**参数**：

- `username`: 用户名

**参数说明**：  

| 参数名称 | 数据类型 | 约束说明 |
|----------|----------|----------|
| `username` | str | **必须参数**，需要查询资料的用户名 |

**返回值说明**：  

- **成功返回**：包含usr_profile表全部字段的字典结构  
  字段说明：  
  - `id`：用户ID（整数）  
  - `nickname`：昵称（字符串）  
  - `gender`：性别（枚举字符串）  
  - `birthdate`：出生日期（YYYY-MM-DD格式）  
  - `height`：身高值（浮点数/cm）  
  - `weight`：体重值（浮点数/kg）  
  - `avatar_mime_type`：头像MIME类型  
  - `avatar_base64`：完整BASE64编码字符串  
- **异常返回**：  
  `None`（用户名不存在/资料记录不存在）

---

### 2.3 更新用户资料  

`update_profile(username: str, **updates: Any) -> int`  

**核心功能**：  
动态更新用户资料字段（支持部分字段更新）  

**参数说明**：  

| 参数名称 | 数据类型 | 约束说明 |
|----------|----------|----------|
| `username` | str | **必须参数**，目标用户名 |
| `**updates` | Any | **动态更新字段键值对**，仅接受以下有效字段：<br/>• `nickname`（字符串）<br/>• `gender`（严格枚举值）<br/>• `birthdate`（YYYY-MM-DD格式）<br/>• `height`（浮点数）<br/>• `weight`（浮点数）<br/>• `avatar_mime_type`（字符串）<br/>• `avatar_base64`（BASE64字符串） |

**返回值说明**：  

| 返回值 | 含义 | 触发场景 |
|--------|------|----------|
| 1 | 操作成功 | 记录成功更新 |
| 0 | 操作失败 | 用户名不存在/无有效字段/SQL错误 |

---

## 3. 运动类型管理 (ExerciseTypesManager)

### 3.1 获取所有运动类型

`get_all_types() -> List[Dict[str, Any]]`

**功能**：获取系统中所有可用的运动类型信息  
**返回**：包含完整运动类型信息的字典列表  
**返回值说明**：  

- 每个字典包含以下字段：
  - `type_id`: 运动类型唯一ID（0-255整数）
  - `type_name`: 运动类型名称（如"跑步"、"游泳"）
  - `type_goal`: 该运动类型的推荐每日目标时长（分钟）
  - `calorie_factor`: 卡路里计算系数（每分钟消耗）

---

### 3.2 获取指定类型信息

`get_type_by_name(type_name: str) -> Optional[Dict[str, Any]]`

**功能**：根据运动类型ID获取详细信息  
**参数说明**：  

- `type_name`: 要查询的运动类型名称，必须有效
**返回**：包含运动类型信息的字典或None  
**返回值说明**：  
- 成功找到时返回包含以下键的字典：
  - `type_id`, `type_name`, `type_goal`, `calorie_factor`
- 未找到匹配记录时返回`None`

---

### 3.3 更新目标时长

`update_type_goal(type_name: str, new_goal: int) -> int`

**功能**：修改运动类型的推荐目标时长  
**参数说明**：  

- `type_name`: 要查询的运动类型名称，必须有效
- `new_goal`: 新的每日目标时长（分钟，正整数）  
**返回**：数据库操作影响的行数  
**返回值说明**：
- `0`：更新失败（无效ID或数据库错误）
- `1`：成功更新目标时长

---

## 4. 运动记录管理 (DailyExerciseManager)

### 4.1 创建/更新运动记录

`create_exercise_record(username: str, exercise_date: date, type_name: str, duration: int) -> int`

**功能**：创建或更新用户每日运动记录（基于用户/日期/类型唯一索引）  
**参数说明**：  

- `username`: 用户唯一标识（大小写敏感）
- `exercise_date`: 运动日期（datetime.date格式，YYYY-MM-DD）
- `type_name`: 运动类型名称（必须存在于exercise_types表）
- `duration`: 运动时长（1-1440分钟的整数）  
**返回**：数据库操作影响的行数  
**返回值说明**：
- `0`：操作失败（用户名无效、运动类型无效或数据库错误）
- `1`：成功插入新记录
- `2`：成功更新已有记录  
**备注**：
- 自动计算消耗卡路里（时长 × 运动类型系数）
- 使用ON DUPLICATE KEY处理重复记录

---

### 4.2 更新运动记录

`update_exercise_record(record_id: int, duration: Optional[int] = None) -> int`

**功能**：修改已有运动记录的时长信息  
**参数说明**：  

- `record_id`: 要修改的记录ID（主键）
- `duration`: 新运动时长（1-1440分钟的整数，如不提供则无操作）  
**返回**：数据库操作影响的行数  
**返回值说明**：
- `0`：更新失败（无效ID、无效时长或数据库错误）
- `1`：成功更新记录  
**备注**：
- 更新后自动重新计算消耗卡路里

---

### 4.3 获取用户运动记录

`get_user_exercise_records(username: str, start_date: Optional[date] = None, end_date: Optional[date] = None) -> List[Dict[str, Any]]`

**功能**：查询用户在时间范围内的运动历史  
**参数说明**：  

- `username`: 目标用户标识
- `start_date`: 筛选起始日期（可选，包含）
- `end_date`: 筛选结束日期（可选，包含）  
**返回**：运动记录字典列表（按日期倒序）  
**返回值字段**：
- `record_id`: 记录唯一ID
- `usr_id`: 用户ID（内部标识）
- `exercise_date`: 运动日期
- `type_name`: 运动类型名称
- `duration`: 实际运动时长
- `calories`: 计算得出的消耗卡路里  
**备注**：  
- 无日期范围参数时返回所有记录
- 用户不存在或无效时返回空列表

---

### 4.4 获取分类运动记录

`get_user_records_by_type(username: str, type_name: str, start_date: Optional[date] = None, end_date: Optional[date] = None) -> List[Dict[str, Any]]`

**功能**：查询用户在特定运动类型和时段的记录  
**参数说明**：  

- `username`: 目标用户标识
- `type_name`: 运动类型名称（必须有效）
- `start_date`: 筛选起始日期（可选）
- `end_date`: 筛选结束日期（可选）  
**返回**：特定类型运动记录的字典列表  
**返回值字段**：同4.3节字段  
**备注**：
- 无日期参数时返回该类型所有记录
- 无效用户/类型时返回空列表

---

### 4.5 获取周汇总数据

`get_weekly_summary(username: str, year_week: Optional[Tuple[int, int]] = None) -> List[Dict[str, Any]]`

**功能**：获取用户按周统计的运动汇总数据  
**参数说明**：  

- `username`: 目标用户标识
- `year_week`: (年份, 周数)元组（可选，如(2023,42)）  
**返回**：按周汇总的数据列表  
**返回值字段**：
- `year_week`: 年份+周数字符串（如"202342"）
- `type_name`: 运动类型名称
- `total_duration`: 该周总运动时长（分钟）
- `total_calories`: 该周消耗总卡路里  
**备注**：
- 无year_week参数时返回所有周数据
- 数据从weekly_exercise视图获取
- 用户不存在时返回空列表

---

### 4.6 获取月汇总数据

`get_monthly_summary(username: str, month: Optional[str] = None) -> List[Dict[str, Any]]`

**功能**：获取用户按月统计的运动汇总数据  
**参数说明**：  

- `username`: 目标用户标识
- `month`: 月份字符串（可选，YYYY-MM格式）  
**返回**：按月汇总的数据列表  
**返回值字段**：
- `date_month`: 年-月字符串（如"2023-10"）
- `type_name`: 运动类型名称
- `total_duration`: 该月总运动时长（分钟）
- `total_calories`: 该月消耗总卡路里  
**备注**：
- 无month参数时返回所有月份数据
- 数据从monthly_exercise视图获取
- 无效月份格式时抛出ValueError
- 用户不存在时返回空列表

---

## 5. 食物管理 (FoodManager)

### 5.1 获取食物信息

```python
get_food_by_id(food_id: int) -> Optional[Dict[str, Any]]
```

**功能**：通过食物ID获取食物的详细信息  
**参数说明**：  

- `food_id`: 食物唯一标识ID（整型）  
**返回**：食物信息字典或None  
**返回值字段说明**（字典中的键）：
- `food_id`: 食物唯一标识ID
- `food_name`: 食物名称（如"苹果"、"牛奶"）
- `calories_per_unit`: 每单位热量（卡路里，浮点数）
- `unit`: 计量单位（如"g"克、"ml"毫升、"个"等）  
**备注**：
- 当食物ID不存在时返回None
- 食物ID范围：0-16777215（MEDIUMINT UNSIGNED）

---

### 5.2 根据名称获取食物

```python
get_food_by_exact_name(food_name: str) -> Optional[Dict[str, Any]]
```

**功能**：通过精确名称匹配获取食物信息  
**参数说明**：  

- `food_name`: 完整食物名称（区分大小写）  
**返回**：食物信息字典或None  
**返回值字段**：同5.1节  
**备注**：
- 需要完整名称精确匹配（不含模糊查询）
- 当名称不存在时返回None

---

### 5.3 获取所有食物

```python
get_all_foods() -> List[Dict[str, Any]]
```

**功能**：获取数据库中所有食物列表  
**返回**：食物信息字典列表（按名称排序）  
**列表项字段**：

- `food_id`: 食物ID
- `food_name`: 食物名称
- `calories_per_unit`: 单位热量
- `unit`: 计量单位  
**备注**：
- 返回格式示例：

  ```python
  [
      {"food_id": 1, "food_name": "苹果", "calories_per_unit": 52.0, "unit": "g"},
      {"food_id": 2, "food_name": "牛奶", "calories_per_unit": 61.0, "unit": "ml"}
  ]
  ```

---

## 6. 饮食记录管理 (DietRecordsManager)

### 6.1 创建/更新饮食记录

```python
create_diet_record(username: str, intake_date: date, food_id: int, quantity: float) -> int
```

**功能**：创建或更新用户的每日饮食记录  
**参数说明**：  

- `username`: 用户名（必须存在于用户表中）
- `intake_date`: 摄入日期（datetime.date格式，YYYY-MM-DD）
- `food_id`: 食物ID（必须存在于食物表中）
- `quantity`: 摄入数量（0.1-2000之间的浮点数）  
**返回**：数据库操作影响的行数  
**返回值说明**：
- `0`：操作失败（用户不存在、食物ID无效或数量超出范围）
- `1`：成功创建新记录
- `2`：成功更新已有记录  
**备注**：
- 自动计算总卡路里（摄入量×单位热量）
- 唯一索引基于(用户ID+日期+食物ID)
- 使用`ON DUPLICATE KEY UPDATE`处理重复记录

---

### 6.2 更新饮食记录

```python
update_diet_record(record_id: int, quantity: Optional[float] = None) -> int
```

**功能**：修改已有的饮食记录摄入量  
**参数说明**：  

- `record_id`: 饮食记录唯一标识ID（必须存在）
- `quantity`: 新摄入量（0.1-2000之间的浮点数，不提供则不更新）  
**返回**：数据库操作影响的行数  
**返回值说明**：
- `0`：更新失败（记录ID不存在或无效数量）
- `1`：成功更新记录  
**备注**：
- 更新后自动重新计算总卡路里
- 只能更新数量，不可修改食物ID或日期

---

### 6.3 获取记录详情

```python
get_record_by_id(record_id: int) -> Optional[Dict[str, Any]]
```

**功能**：通过记录ID获取完整的饮食记录信息  
**参数说明**：  

- `record_id`: 饮食记录唯一标识ID  
**返回**：包含详细信息的字典或None  
**返回值字段说明**：
- `record_id`: 记录唯一ID
- `usr_id`: 用户内部ID
- `intake_date`: 摄入日期
- `food_id`: 食物ID
- `quantity`: 摄入数量
- `calories`: 计算的总卡路里
- `food_name`: 食物名称（通过JOIN foods表获取）
- `unit`: 计量单位（通过JOIN foods表获取）  
**备注**：
- 包含food_name和unit便于前端直接显示
- 记录ID不存在时返回None

---

### 6.4 获取用户饮食记录

```python
get_user_diet_records(username: str, start_date: Optional[date] = None, end_date: Optional[date] = None) -> List[Dict[str, Any]]
```

**功能**：查询用户在指定时间段内的饮食记录  
**参数说明**：  

- `username`: 目标用户标识
- `start_date`: 筛选起始日期（可选）
- `end_date`: 筛选结束日期（可选）  
**返回**：饮食记录字典列表（按日期倒序）  
**返回值字段**：同6.3节（包含所有字段）  
**示例响应**：

```python
[
    {
        "record_id": 101,
        "usr_id": 5,
        "intake_date": date(2023, 10, 15),
        "food_id": 1,
        "quantity": 150.0,
        "calories": 78.0,
        "food_name": "苹果",
        "unit": "g"
    },
    {
        "record_id": 102,
        "usr_id": 5,
        "intake_date": date(2023, 10, 14),
        "food_id": 2,
        "quantity": 200.0,
        "calories": 122.0,
        "food_name": "牛奶",
        "unit": "ml"
    }
]
```

**备注**：

- 无日期参数时返回所有记录
- 用户不存在时返回空列表
- 结果包含关联的食物信息便于直接使用

---

## 7. 健康指标管理 (UserHealthMetricsManager)

### 7.1 创建/更新健康指标

```python
create_health_metrics(
    username: str,
    heart_rate: Optional[int] = None,
    blood_pressure: Optional[str] = None,
    blood_glucose: Optional[Union[float, int]] = None,
    sleep_duration: Optional[Union[float, int]] = None
) -> int
```

**功能**：创建或更新用户的健康指标记录（全量覆盖更新）  
**参数说明**：  

- `username`: 用户唯一标识（必须存在于用户表中）
- `heart_rate`: 静息心率值（30-250 bpm，整数）
- `blood_pressure`: 血压值（收缩压/舒张压格式，如"120/80"）
- `blood_glucose`: 空腹血糖值（0-33.3 mmol/L）
- `sleep_duration`: 前一日睡眠时长（0-24小时）  
**返回**：数据库操作影响的行数  
**返回值说明**：
- `0`：操作失败（用户不存在或数据库错误）
- `1`：成功创建新记录
- `2`：成功更新已有记录  
**备注**：
- 使用ON DUPLICATE KEY UPDATE实现"存在更新/不存在插入"逻辑
- 不传递的字段会被设为NULL（清空原有值）
- 每个用户最多有1条记录（使用用户ID作为主键）

---

### 7.2 更新健康指标

```python
update_health_metrics(username: str, **updates: Any) -> int
```

**功能**：部分更新用户的健康指标（只更新指定字段）  
**参数说明**：  

- `username`: 目标用户标识
- `updates`: 关键字段和值的映射（支持以下任意字段）
  - `heart_rate`：更新心率值
  - `blood_pressure`：更新血压值
  - `blood_glucose`：更新血糖值
  - `sleep_duration`：更新睡眠时长  
**返回**：数据库操作影响的行数  
**返回值说明**：
- `0`：更新失败（用户不存在、无效字段或数据库错误）
- `1`：成功更新记录  
**备注**：
- 只更新传入的字段，未提及字段保持原值
- 示例调用：

  ```python
  # 只更新心率和血压
  update_health_metrics("johndoe", heart_rate=75, blood_pressure="118/76")
  ```

---

### 7.3 获取健康指标

```python
get_health_metrics(username: str) -> Optional[Dict[str, Any]]
```

**功能**：查询用户的健康指标信息  
**参数说明**：  

- `username`: 目标用户标识  
**返回**：健康指标信息字典或None  
**返回值字段说明**：
- `id`: 用户ID（内部标识）
- `heart_rate`: 静息心率（bpm）
- `blood_pressure`: 血压值（收缩压/舒张压）
- `blood_glucose`: 空腹血糖（mmol/L）
- `sleep_duration`: 睡眠时长（小时）  
**备注**：
- 用户不存在或没有健康记录时返回None
- 字段值可为NULL（未记录）
- 示例响应：

  ```python
  {
      "id": 101,
      "heart_rate": 72,
      "blood_pressure": "120/80",
      "blood_glucose": 5.3,
      "sleep_duration": 7.2
  }
  ```

---

## 8. 帖子管理 (PostManager)

### 8.1 创建帖子

```python
create_post(username: str, content: str, 
            image_base64: Optional[str] = None,
            mime_type: Optional[str] = None) -> int
```

**功能**：为用户创建新的社区帖子  
**参数说明**：  

- `username`: 发帖用户名（必须存在于用户表中）
- `content`: 帖子文本内容（建议≤5000字符）
- `image_base64`: Base64编码的图片数据（可选）
- `mime_type`: 图片的MIME类型（如"image/jpeg"，提供图片时必须）  
**返回**：新创建的帖子ID  
**返回值说明**：
- `0`：创建失败（用户不存在或数据库错误）
- 正整数：成功创建的帖子ID  
**备注**：
- 图片和MIME类型必须同时提供或不提供
- 基础验证：`content`不能为空
- 创建时间自动记录为当前时间
- 新帖点赞数初始化为0

---

### 8.2 更新帖子

```python
update_post(post_id: int, 
            new_content: Optional[str] = None,
            new_image: Optional[str] = None,
            new_mime_type: Optional[str] = None) -> int
```

**功能**：修改现有帖子的内容或图片  
**参数说明**：  

- `post_id`: 要修改的帖子ID（必须存在）
- `new_content`: 新文本内容（可选，`None`保持原值）
- `new_image`: 新Base64图片数据（可选）
- `new_mime_type`: 新图片的MIME类型（可选）  
**返回**：数据库操作影响的行数  
**返回值说明**：
- `0`：更新失败（帖子不存在或无效参数）
- `1`：成功更新  
**备注**：
- 可单独更新文本或图片
- 提供新图片时建议同时更新`mime_type`
- 未传递的字段保持不变

---

### 8.3 点赞管理

```python
increment_like_count(post_id: int, increment: int = 1) -> int
```

**功能**：增加或减少帖子的点赞数  
**参数说明**：  

- `post_id`: 目标帖子ID
- `increment`: 点赞增减量（默认为+1，可为负值减少）  
**返回**：数据库操作影响的行数  
**返回值说明**：
- `0`：操作失败（帖子不存在）
- `1`：成功更新点赞数  
**备注**：
- 保证点赞数不会为负（最小0）
- 典型应用场景：
  - 用户点赞：`increment=1`
  - 用户取消点赞：`increment=-1`

---

### 8.4 删除帖子

```python
delete_post(post_id: int) -> int
```

**功能**：永久删除帖子及其相关数据  
**参数说明**：  

- `post_id`: 要删除的帖子ID  
**返回**：数据库操作影响的行数  
**返回值说明**：
- `0`：删除失败（帖子不存在）
- `1`：成功删除  
**备注**：
- 级联删除所有相关数据（如评论）
- 删除后无法恢复

---

### 8.5 获取帖子详情

```python
get_post_by_id(post_id: int, include_image: bool = False) -> Optional[Dict[str, Any]]
```

**功能**：获取帖子的完整详细信息  
**参数说明**：  

- `post_id`: 目标帖子ID
- `include_image`: 是否返回Base64图片数据（默认不包含）  
**返回**：帖子信息字典或None  
**返回值字段说明**：
- `post_id`: 帖子唯一ID
- `created_time`: 创建时间（`datetime`格式）
- `user_id`: 作者内部ID
- `content`: 帖子内容
- `like_count`: 当前点赞数
- `image_base64`: 仅当`include_image=True`时返回（可能为`None`）
- `mime_type`: 仅当`include_image=True`时返回  
**备注**：
- 帖子不存在时返回`None`
- 默认不返回图片数据（减少数据传输量）

---

### 8.6 获取用户帖子

```python
get_posts_by_user(username: str, page: int = 1, per_page: int = 10) -> Dict[str, Any]
```

**功能**：分页获取用户的发帖历史（按时间倒序）  
**参数说明**：  

- `username`: 目标用户名
- `page`: 请求的页码（从1开始）
- `per_page`: 每页显示的帖数（默认10）  
**返回**：分页结构化的结果字典  
**返回值字段说明**：
- `posts`: 帖子列表（不含图片数据）
  - `post_id`: 帖子ID
  - `created_time`: 发布时间
  - `content`: 帖子内容
  - `like_count`: 点赞数
- `total`: 用户总帖数
- `total_pages`: 总页数
- `current_page`: 当前页码  
**示例响应**：

```python
{
    "posts": [
        {"post_id": 101, "created_time": datetime(2023,10,15), 
         "content": "今日运动打卡...", "like_count": 12},
        # ...其他帖子
    ],
    "total": 25,
    "total_pages": 3,
    "current_page": 1
}
```

**备注**：

- 用户不存在时返回空结果结构
- 页码超出范围时返回最后一页数据

---

#### 8.7 获取近期帖子

```python
get_recent_posts(days: int = 7, limit: int = 20) -> List[Dict[str, Any]]
```

**功能**：获取最近发布的社区帖子（时间倒序）  
**参数说明**：  

- `days`: 时间范围（最近多少天，默认7天）
- `limit`: 返回的最大帖数（默认20）  
**返回**：近期帖子摘要列表  
**返回值字段说明**：
- `post_id`: 帖子ID
- `created_time`: 发布时间
- `user_id`: 作者内部ID
- `preview`: 内容预览（前100字符）
- `like_count`: 当前点赞数  
**备注**：
- 用于"最新动态"类列表展示
- 不包含完整内容和图片数据
- 时间范围或限制≤0时返回空列表

---

### 8.8 获取帖子图片

```python
get_post_image(post_id: int) -> Optional[Dict[str, Any]]
```

**功能**：单独获取帖子的图片数据  
**参数说明**：  

- `post_id`: 目标帖子ID  
**返回**：图片数据字典或None  
**返回值字段说明**：
- `image_base64`: Base64编码的图片数据
- `mime_type`: 图片类型（如"image/png"）  
**备注**：
- 帖子无图片时返回`None`
- 与`get_post_by_id(include_image=True)`的区别：
  - 只返回图片数据，不包括其他帖文信息
  - 适用于单独加载图片的场景
